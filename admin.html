<!doctype html>
<html lang="he" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>לוח הזמנות | חזי בצומת</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./admin.css?v=20260301-chat-1" />
  </head>
  <body>
    <div class="pin-gate" id="pinGate">
      <div class="pin-card">
        <h1>כניסת מנהל</h1>
        <p>הקלידו PIN כדי לצפות בכל ההזמנות בזמן אמת.</p>
        <label for="pinInput">PIN</label>
        <input
          id="pinInput"
          type="password"
          inputmode="numeric"
          autocomplete="one-time-code"
          placeholder="••••"
        />
        <button id="pinSubmit" type="button">כניסה</button>
        <p class="pin-error" id="pinError" aria-live="polite"></p>
      </div>
    </div>

    <main class="dashboard" id="dashboard" hidden>
      <header class="topbar">
        <div>
          <h2>לוח הזמנות חי</h2>
          <p id="lastSync">ממתין לעדכון...</p>
        </div>
        <div class="topbar-actions">
          <button id="openHistoryViewBtn" type="button">היסטוריית הזמנות</button>
          <button id="openSupportChatsViewBtn" type="button">צ׳אט שירות לקוחות</button>
          <button id="enableNotificationsBtn" type="button">אפשר התראות דפדפן</button>
          <button id="openDeleteOrdersBtn" type="button">מחיקת הזמנות</button>
          <button id="logoutBtn" class="logout-btn" type="button">התנתק</button>
        </div>
      </header>

      <section id="liveBoardView">
        <section class="counters">
          <article>
            <span>חדש</span>
            <strong id="countNew">0</strong>
          </article>
          <article>
            <span>בהכנה</span>
            <strong id="countInProgress">0</strong>
          </article>
          <article>
            <span>מוכן</span>
            <strong id="countReady">0</strong>
          </article>
        </section>

        <section class="delivery-filter-row">
          <label class="delivery-filter-toggle" for="onlyDeniedDeliveryToggle">
            <input id="onlyDeniedDeliveryToggle" type="checkbox" />
            <span>הראה רק לקוחות שסימנו לא נמסר</span>
          </label>
        </section>

        <section class="selection-toolbar" id="selectionToolbar" hidden>
          <div class="selection-toolbar-info" id="selectionToolbarInfo">בחירת הזמנות פעילה</div>
          <div class="selection-toolbar-actions">
            <button id="selectAllOrdersBtn" type="button">בחר הכול</button>
            <button id="clearAllOrdersBtn" type="button">בטל הכול</button>
            <button id="deleteSelectedOrdersBtn" class="danger" type="button">מחק נבחרים (0)</button>
          </div>
        </section>

        <section id="ordersList" class="orders-list" aria-live="polite"></section>
        <p id="emptyState" class="empty-state">אין הזמנות להצגה כרגע.</p>
      </section>

      <section id="historyView" hidden>
        <header class="history-head">
          <div>
            <h3>היסטוריית הזמנות</h3>
            <p>מוצגות רק הזמנות שהלקוח אישר כנמסרות.</p>
          </div>
          <button id="closeHistoryViewBtn" type="button">חזרה ללוח הזמנות</button>
        </header>

        <section class="history-controls">
          <input
            id="historySearchInput"
            type="search"
            placeholder="חיפוש לפי שם / טלפון / מספר הזמנה"
            autocomplete="off"
          />
          <div class="history-range-buttons" id="historyRangeButtons">
            <button type="button" data-range="today">היום</button>
            <button type="button" data-range="yesterday">אתמול</button>
            <button type="button" data-range="7d">7 ימים</button>
            <button type="button" data-range="all" class="active">הכול</button>
          </div>
        </section>

        <section id="historyOrdersList" class="orders-list" aria-live="polite"></section>
        <p id="historyEmptyState" class="empty-state">אין הזמנות בהיסטוריה כרגע.</p>
        <div class="history-load-more-wrap">
          <button id="historyLoadMoreBtn" type="button" hidden>טען עוד</button>
        </div>
      </section>

      <section id="supportChatsView" hidden>
        <header class="history-head">
          <div>
            <h3>צ׳אט שירות לקוחות</h3>
            <p>שיחות חדשות ומענה בזמן אמת.</p>
          </div>
          <button id="closeSupportChatsViewBtn" type="button">חזרה ללוח הזמנות</button>
        </header>

        <div class="support-admin-layout">
          <aside class="support-chat-list-wrap">
            <div id="supportChatsList" class="support-chat-list" aria-live="polite"></div>
            <p id="supportChatsEmptyState" class="empty-state">אין שיחות פעילות כרגע.</p>
          </aside>

          <section class="support-chat-panel" id="supportChatPanel">
            <div id="supportChatPanelEmpty" class="support-chat-panel-empty">
              בחרו שיחה מהרשימה כדי להתחיל מענה.
            </div>
            <div id="supportChatPanelBody" hidden>
              <header class="support-chat-panel-head">
                <div>
                  <h4 id="supportChatPanelTitle">צ׳אט</h4>
                  <p id="supportChatPanelMeta"></p>
                </div>
                <div class="support-chat-panel-actions">
                  <span id="supportChatPanelStatus" class="status-pill">פתוח</span>
                  <button id="closeSupportChatBtn" type="button">סגור צ׳אט</button>
                </div>
              </header>
              <div id="supportChatMessages" class="support-chat-messages"></div>
              <form id="supportChatComposeForm" class="support-chat-compose-form">
                <label for="supportChatInput">תגובה ללקוח</label>
                <textarea
                  id="supportChatInput"
                  maxlength="500"
                  placeholder="כתבו תגובה לשירות הלקוחות..."
                ></textarea>
                <div class="support-chat-compose-foot">
                  <span id="supportChatCharCount">נותרו 500 תווים</span>
                  <button id="supportChatSendBtn" type="submit">שלח</button>
                </div>
                <p id="supportChatError" class="order-reply-error" aria-live="polite"></p>
              </form>
            </div>
          </section>
        </div>
      </section>
    </main>

    <div class="admin-modal-backdrop" id="deleteOrdersBackdrop" hidden></div>
    <section
      class="admin-modal"
      id="deleteOrdersModal"
      role="dialog"
      aria-modal="true"
      aria-labelledby="deleteOrdersTitle"
      hidden
    >
      <header class="admin-modal-head">
        <h3 id="deleteOrdersTitle">מחיקת הזמנות</h3>
        <button id="closeDeleteOrdersModalBtn" class="icon-btn" type="button" aria-label="סגירה">
          ×
        </button>
      </header>
      <p class="admin-modal-subtitle">בחרו סוג מחיקה ואשרו באמצעות הקלדת "מחק".</p>

      <fieldset class="delete-options-group">
        <legend>אפשרויות מחיקה</legend>
        <label class="radio-line">
          <input type="radio" name="deleteMode" value="all" checked />
          <span>מחק הכול</span>
        </label>
        <label class="radio-line">
          <input type="radio" name="deleteMode" value="status" />
          <span>מחק לפי סטטוס</span>
        </label>
        <label class="radio-line">
          <input type="radio" name="deleteMode" value="selection" />
          <span>מחק לפי בחירה</span>
        </label>
      </fieldset>

      <fieldset class="delete-options-group" id="statusFilterGroup" hidden>
        <legend>בחרו סטטוסים למחיקה</legend>
        <label class="check-line">
          <input type="checkbox" class="status-delete-filter" value="delivered" />
          <span>נמסר</span>
        </label>
        <label class="check-line">
          <input type="checkbox" class="status-delete-filter" value="ready" />
          <span>מוכן</span>
        </label>
        <label class="check-line">
          <input type="checkbox" class="status-delete-filter" value="cancelled" />
          <span>בוטל</span>
        </label>
      </fieldset>

      <p class="selection-note" id="selectionModeNote" hidden>
        מצב בחירה מופעל ברשימה. סמנו הזמנות באמצעות תיבות הסימון בכרטיסים.
      </p>
      <p class="delete-count" id="deleteMatchCount">נמצאו 0 הזמנות למחיקה.</p>

      <label for="deleteConfirmInput" class="confirm-label">הקלידו "מחק" לאישור:</label>
      <input id="deleteConfirmInput" class="confirm-input" type="text" autocomplete="off" />
      <p class="modal-error" id="deleteModalError" aria-live="polite"></p>

      <div class="admin-modal-actions">
        <button id="cancelDeleteOrdersBtn" type="button">ביטול</button>
        <button id="executeDeleteOrdersBtn" class="danger" type="button" disabled>מחק</button>
      </div>
    </section>

    <div class="admin-toast" id="adminToast" role="status" aria-live="polite"></div>

    <script type="module" src="./admin.js?v=20260301-chat-1"></script>
  </body>
</html>
