(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))c(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&c(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function c(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();const A="972500000000",H={0:{open:"07:00",close:"13:00",label:"יום א׳"},1:{open:"07:00",close:"13:00",label:"יום ב׳"},2:{open:"07:00",close:"13:00",label:"יום ג׳"},3:{open:"07:00",close:"13:00",label:"יום ד׳"},4:{open:"07:00",close:"13:00",label:"יום ה׳"},5:{open:"07:00",close:"12:00",label:"יום ו׳"},6:null},W="העגלה של איציק",_="ההדרים 178, אבן יהודה",R="050-0000000",C="itziks-cart-order-v1",f=15,O=Array.from(document.querySelectorAll("#menu [data-item-id]")),D=new Map,w=document.getElementById("cartPanel"),N=document.getElementById("cartItems"),U=document.getElementById("cartEmpty"),F=document.getElementById("cartTotal"),j=document.getElementById("cartTotalInline"),z=document.getElementById("clearCartBtn"),K=document.getElementById("sendOrderBtn"),P=document.getElementById("mobileCartToggle"),Q=document.getElementById("mobileWhatsappBtn"),d=document.getElementById("pickupTime"),G=document.getElementById("pickupHint"),b=document.getElementById("customerName"),I=document.getElementById("customerPhone"),v=document.getElementById("customerNotes"),g=document.getElementById("formError"),y=document.getElementById("backToTop"),m=document.getElementById("toast"),J=document.getElementById("copyPhone"),s={cart:{},name:"",phone:"",notes:"",pickup:""};function p(e){return`₪${e}`}function V(e){const t=e.dataset.itemId,n=e.dataset.itemName,c=Number(e.dataset.itemPrice||0);return!t||!n||Number.isNaN(c)?null:{id:t,name:n,price:c,node:e}}function Y(e){const t=document.createElement("div");t.className="order-controls";const n=document.createElement("button");n.type="button",n.className="qty-btn",n.textContent="+",n.setAttribute("aria-label",`הוסף ${e.name}`);const c=document.createElement("span");c.className="qty-display",c.id=`qty-${e.id}`,c.textContent="0";const o=document.createElement("button");return o.type="button",o.className="qty-btn",o.textContent="-",o.setAttribute("aria-label",`הסר ${e.name}`),n.addEventListener("click",()=>B(e.id,T(e.id)+1)),o.addEventListener("click",()=>B(e.id,T(e.id)-1)),t.append(n,c,o),t}function X(e){const t=e.node.querySelector(".price");if(!t)return;const n=document.createElement("div");n.className=e.node.classList.contains("combo")?"combo-actions":"menu-item-actions",t.replaceWith(n),n.append(t,Y(e))}function T(e){return Number(s.cart[e]||0)}function B(e,t){t<=0?delete s.cart[e]:s.cart[e]=t,a(),E()}function L(){return Object.entries(s.cart).map(([e,t])=>{const n=D.get(e);return n?{id:e,quantity:t,name:n.name,price:n.price,lineTotal:n.price*t}:null}).filter(Boolean)}function M(e){return e.reduce((t,n)=>t+n.lineTotal,0)}function E(){const e=L(),t=M(e);O.forEach(o=>{const r=o.dataset.itemId,i=document.getElementById(`qty-${r}`);i&&(i.textContent=String(T(r)))}),N.innerHTML="",U.style.display=e.length===0?"block":"none",e.forEach(o=>{const r=document.createElement("div");r.className="cart-item",r.innerHTML=`
      <div>
        <div class="cart-item-name">${o.name}</div>
        <div class="cart-item-meta">${o.quantity} x ${p(o.price)}</div>
      </div>
      <div class="cart-line-total">${p(o.lineTotal)}</div>
    `,N.append(r)});const n=p(t);F.textContent=n,j.textContent=n;const c=w.classList.contains("open")?"סגור עגלה":"פתח עגלה";P.textContent=`${c} (${n})`}function a(){const e={cart:s.cart,name:s.name,phone:s.phone,notes:s.notes,pickup:s.pickup};localStorage.setItem(C,JSON.stringify(e))}function Z(){const e=localStorage.getItem(C);if(e)try{const t=JSON.parse(e);s.cart=t.cart&&typeof t.cart=="object"?t.cart:{},s.name=typeof t.name=="string"?t.name:"",s.phone=typeof t.phone=="string"?t.phone:"",s.notes=typeof t.notes=="string"?t.notes:"",s.pickup=typeof t.pickup=="string"?t.pickup:""}catch{s.cart={}}}function ee(e){return e.replace(/[\s\-()]/g,"")}function te(e){const t=ee(e);return/^(?:\+972|972|0)(?:[2-4]|[8-9])\d{7}$/.test(t)||/^(?:\+972|972|0)5\d{8}$/.test(t)}function q(e){const t=new Date(e);t.setSeconds(0,0);const n=t.getMinutes(),c=n%f;return c!==0&&t.setMinutes(n+(f-c)),t}function S(e){const t=H[e.getDay()];if(!t)return null;const[n,c]=t.open.split(":").map(Number),[o,r]=t.close.split(":").map(Number),i=new Date(e);i.setHours(n,c,0,0);const l=new Date(e);return l.setHours(o,r,0,0),{...t,openTime:i,closeTime:l}}function ne(e){return e.toLocaleTimeString("he-IL",{hour:"2-digit",minute:"2-digit",hour12:!1})}function k(e){return`${["א׳","ב׳","ג׳","ד׳","ה׳","ו׳","שבת"][e.getDay()]} ${ne(e)}`}function oe(e){const t=new Date(e);for(let n=0;n<8;n+=1){const c=new Date(t);c.setDate(t.getDate()+n);const o=S(c);if(o&&(n===0&&e<o.openTime||n>0))return o.openTime}return null}function $(e,t){const n=[];let c=q(e);for(;c<=t;){const o=S(c);o&&c>=o.openTime&&c<=o.closeTime&&n.push(new Date(c)),c=new Date(c.getTime()+f*60*1e3)}return n}function ce(){const e=new Date,t=q(new Date(e.getTime()+f*60*1e3)),n=new Date(e.getTime()+2*60*60*1e3),c=S(e),o=c&&e>=c.openTime&&e<=c.closeTime,r=oe(e);let i=$(t,n),l="בחרו זמן איסוף בטווח של 15 דקות.";if(!o&&r&&(l=`כרגע אנחנו מחוץ לשעות הפעילות. פתיחה הבאה: ${k(r)}.`),i.length===0)if(r){const u=new Date(r.getTime()+72e5);i=$(r,u)}else l="לא נמצאה שעה פנויה כרגע.";d.innerHTML='<option value="">בחרו שעה</option>',i.forEach(u=>{const h=document.createElement("option");h.value=u.toISOString(),h.textContent=k(u),d.append(h)}),s.pickup&&i.some(u=>u.toISOString()===s.pickup)?d.value=s.pickup:s.pickup="",G.textContent=l,a()}function se(){const e=d.selectedOptions[0];return e?e.textContent:""}function re(){return L().length===0?"העגלה ריקה. הוסיפו לפחות פריט אחד.":s.name.trim()?te(s.phone)?s.pickup?"":"יש לבחור שעת איסוף.":"יש להזין מספר טלפון ישראלי תקין.":"יש להזין שם."}function ie(e,t){const n=e.map(o=>`- ${o.name} x${o.quantity} | ${p(o.lineTotal)}`),c=s.notes.trim()?s.notes.trim():"ללא";return[`הזמנה חדשה - ${W}`,`כתובת: ${_}`,"","פריטים:",...n,"",`סה"כ: ${p(t)}`,`שעת איסוף: ${se()}`,"",`שם: ${s.name.trim()}`,`טלפון: ${s.phone.trim()}`,`הערות: ${c}`].join(`
`)}function x(){g.textContent="";const e=re();if(e){g.textContent=e,w.classList.add("open");return}const t=L(),n=M(t),c=ie(t,n),o=`https://wa.me/${A}?text=${encodeURIComponent(c)}`;window.open(o,"_blank","noopener")}function ae(){document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",t=>{const n=e.getAttribute("href");if(!n||n.length===1)return;const c=document.querySelector(n);c&&(t.preventDefault(),c.scrollIntoView({behavior:"smooth",block:"start"}))})}),window.addEventListener("scroll",()=>{window.scrollY>400?y.classList.add("show"):y.classList.remove("show")}),y.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}),J.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(R),m.classList.add("show"),setTimeout(()=>m.classList.remove("show"),1600)}catch{m.textContent="העתקה נכשלה",m.classList.add("show"),setTimeout(()=>{m.classList.remove("show"),m.textContent="המספר הועתק"},1600)}})}function le(){O.forEach(e=>{const t=V(e);t&&(D.set(t.id,t),X(t))})}function ue(){d.addEventListener("change",()=>{s.pickup=d.value,g.textContent="",a()}),b.addEventListener("input",()=>{s.name=b.value,a()}),I.addEventListener("input",()=>{s.phone=I.value,a()}),v.addEventListener("input",()=>{s.notes=v.value,a()}),z.addEventListener("click",()=>{s.cart={},g.textContent="",a(),E()}),K.addEventListener("click",x),Q.addEventListener("click",x),P.addEventListener("click",()=>{w.classList.toggle("open"),E()})}function me(){b.value=s.name,I.value=s.phone,v.value=s.notes}function de(){Z(),le(),me(),ce(),ue(),E(),ae()}de();
